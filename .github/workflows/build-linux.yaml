---
name: build modp on linux
on:
  push:
    branches:
      - $default-branch
  pull_request:
    branches:
      - $default-branch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: install dependencies
        run: apt install -y build-essential cmake fftw3-dev git libarchive-dev libopenmpt-dev libsdl2-dev libsidplayfp-dev libxmp-dev portaudio19-dev
      - name: glone game-music-emu
        run: git clone https://bitbucket.org/mpyne/game-music-emu.git --recurse-submodules
      - name: patch, build and install gme
        run: cd game-music-emu && patch -p1 < ../contrib/gme-b3d158a-playlist.patch && mkdir -p build && cd build && cmake ../ -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX=/ && make install
      - name: build modp
        run: make
